---
import Button from './Button.astro';
import Badge from './Badge.astro';
import Heading from './Heading.astro';

const { casino, review, index } = Astro.props;

const FALLBACK_ICON =
	'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzlDQTNBRiI+PHBhdGggZD0iTTEyIDFMMyA1djZjMCA1LjU1IDMuODQgMTAuNzQgOSAxMiA1LjE2LTEuMjYgOS02LjQ1IDktMTJWNWwtOS00em0wIDEwLjk5aDdjLS41MyA0LjEyLTMuMjggNy43OS03IDguOTRWMTJINVY2LjNsNy0zLjExdjguOHoiLz48L3N2Zz4=';
---

<article
	class='bg-white rounded-card shadow-card border border-primary-200 overflow-hidden hover:shadow-card-hover transition-all duration-300 flex flex-col h-full group'
>
	<!-- Hero / Mock Browser Header -->
	<div
		class='relative bg-primary-900 border-b border-primary-200 pt-8 pb-4 px-4 flex items-center justify-center overflow-hidden group-hover:bg-primary-700 transition-colors'
	>
		<!-- Background Thumbnail (Blurred Logo) -->
		<div
			class='absolute inset-0 opacity-100 bg-center bg-cover bg-no-repeat transition-transform group-hover:scale-110 duration-700'
			style={`background-image: url(${casino.thumbnail_url || casino.logo_url});`}
		>
		</div>

		<!-- Gradient Overlay -->
		<div
			class='absolute inset-0 bg-gradient-to-t from-primary-900/80 to-primary-900/20'
		>
		</div>

		<!-- Browser Dots -->
		<div class='absolute top-3 left-4 flex gap-1.5 opacity-70 z-10'>
			<div class='w-2.5 h-2.5 rounded-full bg-accent-600'></div>
			<div class='w-2.5 h-2.5 rounded-full bg-bonus-400'></div>
			<div class='w-2.5 h-2.5 rounded-full bg-success-600'></div>
		</div>

		<!-- Logo as "Thumbnail" Content -->
		<div
			class='relative z-10 w-24 h-24 bg-white rounded-card shadow-button border border-primary-200 flex items-center justify-center p-0 overflow-hidden transform group-hover:scale-105 transition-transform'
		>
			<img
				src={casino.logo_url || FALLBACK_ICON}
				alt={`${casino.name} Logo`}
				class='w-full h-full object-contain rounded-card'
				onerror={`this.onerror=null; this.src='${FALLBACK_ICON}';`}
			/>
		</div>
	</div>

	<!-- Body -->
	<div class='p-card flex-col flex flex-grow'>
		<!-- Title & Rating -->
		<div class='flex justify-between items-start mb-3'>
			<Heading level={2} as="card-title" class="group-hover:text-accent-600 transition-colors">
				<a href={`/reviews/${review.slug}/`} class='no-underline'>
					{casino.name}
				</a>
			</Heading>
			<Badge variant="bonus" size="sm">
				★ {review.data.rating}/5
			</Badge>
		</div>

		<!-- Bonus -->
		<div class='mb-4'>
			<span
				class='block text-[10px] uppercase font-bold text-primary-600 tracking-wider mb-1'
				>Welcome Bonus</span
			>
			<p class='font-bold text-sm text-primary-700 leading-snug'>
				{casino.bonus_offer}
			</p>
		</div>

		<!-- Description -->
		<p class='text-xs text-primary-600 line-clamp-3 leading-relaxed mb-4'>
			{review.data.metaDescription}
		</p>

		<!-- Specs Grid -->
		<div
			class='grid grid-cols-2 gap-2 mt-auto text-[10px] font-bold text-primary-600 border-t border-primary-200 pt-3'
		>
			<div class='flex flex-col'>
				<span class='uppercase text-primary-300'>Payout</span>
				<span class='text-primary-700'>⚡ {casino.payout_speed_minutes} mins</span
				>
			</div>
			<div class='flex flex-col text-right'>
				<span class='uppercase text-primary-300'>RTP</span>
				<span class='text-success-600'>{casino.payout_ratio}%</span>
			</div>
		</div>
	</div>

	<!-- Footer Actions -->
	<div class='p-4 bg-primary-50 border-t border-primary-200 flex gap-2'>
		<Button
			href={`/reviews/${review.slug}/`}
			variant="secondary"
			size="sm"
			class="flex-1 text-xs uppercase tracking-wide"
		>
			Read Review
		</Button>
		<Button
			href={casino.website_url}
			variant="primary"
			size="sm"
			class="flex-1 text-xs uppercase tracking-wide"
		>
			Visit
		</Button>
	</div>
</article>
