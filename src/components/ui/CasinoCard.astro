---
import Button from './Button.astro';
import Badge from './Badge.astro';
import Heading from './Heading.astro';

const { casino, review, index } = Astro.props;

const FALLBACK_ICON =
	'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzlDQTNBRiI+PHBhdGggZD0iTTEyIDFMMyA1djZjMCA1LjU1IDMuODQgMTAuNzQgOSAxMiA1LjE2LTEuMjYgOS02LjQ1IDktMTJWNWwtOS00em0wIDEwLjk5aDdjLS41MyA0LjEyLTMuMjggNy43OS03IDguOTRWMTJINVY2LjNsNy0zLjExdjguOHoiLz48L3N2Zz4=';
---

<div
	class='bg-white rounded-card shadow-card border border-primary-200 overflow-hidden hover:shadow-card-hover transition-shadow relative group'
>
	<!-- MOBILE / TABLET VIEW (< 1024px) -->
	<div class='lg:hidden p-card flex flex-col gap-4'>
		<!-- Top Row: Logo, Rank, Name, Info -->
		<div class='flex items-start gap-4'>
			<!-- Rank Badge (Optional context) -->
			<div
				class='absolute top-0 left-0 bg-primary-100 text-primary-600 text-xs font-bold px-3 py-1 rounded-br-lg z-10 border-b border-r border-primary-200'
			>
				#{index + 1}
			</div>

			<div
				class='w-24 h-24 flex-shrink-0 flex items-center justify-center mt-2 overflow-hidden rounded-card'
			>
				<img
					src={casino.logo_url || FALLBACK_ICON}
					alt={`${casino.name} Logo`}
					class='w-full h-full object-contain rounded-card'
					onerror={`this.onerror=null; this.src='${FALLBACK_ICON}';`}
				/>
			</div>
			<div class='flex-grow pt-1'>
				<Heading level={3} as="card-title" class="mb-1">
					<a
						href={`/reviews/${review.slug}/`}
						class='hover:text-accent-600 transition-colors no-underline'
					>
						{casino.name}
					</a>
				</Heading>
				<div class='flex flex-wrap gap-2 mb-2'>
					<Badge variant="success" size="sm">
						{review.data.rating}/5 Rating
					</Badge>
					<Badge variant="info" size="sm">
						{casino.license || 'Licensed'}
					</Badge>
				</div>
				<p class='text-sm text-primary-600 line-clamp-2 leading-tight'>
					{review.data.metaDescription}
				</p>
			</div>
		</div>

		<!-- Middle: Bonus Box -->
		<div class='bg-primary-50 border border-primary-200 rounded-btn p-3 text-center'>
			<span
				class='block text-xs font-bold text-primary-600 uppercase tracking-wide mb-1'
				>Welcome Offer</span
			>
			<span class='block text-lg font-black text-primary-900'
				>{casino.bonus_offer}</span
			>
		</div>

		<!-- Bottom: Specs & CTA -->
		<div
			class='flex flex-wrap items-center justify-between gap-4 border-t border-primary-200 pt-3'
		>
			<div class='flex flex-col gap-1'>
				<span class='text-sm font-bold text-primary-700'
					>âš¡ {casino.payout_speed_minutes} mins</span
				>
			</div>
			<Button
				href={`/reviews/${review.slug}/`}
				variant="secondary"
				size="md"
				fullWidth
				class="sm:flex-grow-0 text-sm uppercase tracking-wide"
			>
				Read Review
			</Button>
			<Button
				href={casino.website_url}
				variant="primary"
				size="md"
				fullWidth
				class="sm:flex-grow-0 text-sm uppercase tracking-wide"
			>
				Play Now
			</Button>
		</div>
	</div>

	<!-- DESKTOP VIEW (>= 1024px) -->
	<div class='hidden lg:grid grid-cols-12 gap-4 items-center p-card-sm min-h-[100px]'>
		<!-- Rank -->
		<div class='col-span-1 flex justify-center'>
			<div
				class='w-10 h-10 rounded-badge bg-primary-50 text-primary-600 font-bold text-lg flex items-center justify-center border border-primary-200'
			>
				{index + 1}
			</div>
		</div>

		<!-- Info -->
		<div class='col-span-4 flex items-center gap-4'>
			<div
				class='w-24 h-24 flex-shrink-0 flex items-center justify-center overflow-hidden rounded-card'
			>
				<img
					src={casino.logo_url || FALLBACK_ICON}
					alt={`${casino.name} Logo`}
					class='w-full h-full object-contain rounded-card'
					onerror={`this.onerror=null; this.src='${FALLBACK_ICON}';`}
				/>
			</div>
			<div>
				<a
					href={`/reviews/${review.slug}/`}
					class='font-bold text-xl text-primary-900 hover:text-accent-600 transition-colors no-underline block'
				>
					{casino.name}
				</a>
				<div class='flex items-center gap-2 mt-1'>
					<Badge variant="bonus" size="sm">
						â˜… {review.data.rating}/5
					</Badge>
					<Badge variant="info" size="sm" border={false}>
						ðŸ“ˆ {casino.payout_ratio}% RTP
					</Badge>
				</div>
				<p class='text-xs text-primary-600 mt-2 line-clamp-1 max-w-[200px]'>
					{review.data.metaDescription}
				</p>
			</div>
		</div>

		<!-- Logos (Software & Banking Mixed) -->
		<div class='col-span-3 flex flex-col justify-center gap-3'>
			<div class='flex items-center gap-2 overflow-hidden'>
				<span
					class='text-[10px] uppercase font-bold text-primary-600 w-12 shrink-0'
					>Games</span
				>
				{
					casino.software
						?.slice(0, 4)
						.map((s: any) => (
							<img
								src={s.logo_url}
								title={s.name}
								alt={s.name}
								class='h-10 w-auto object-contain grayscale hover:grayscale-0 opacity-80 hover:opacity-100 transition-all cursor-help'
							/>
						))
				}
			</div>
			<div class='flex items-center gap-2 overflow-hidden'>
				<span
					class='text-[10px] uppercase font-bold text-primary-600 w-12 shrink-0'
					>Bank</span
				>
				{
					casino.payments
						?.slice(0, 5)
						.map((p: any) => (
							<img
								src={p.logo_url}
								title={p.name}
								alt={p.name}
								class='h-6 w-auto object-contain'
							/>
						))
				}
			</div>
		</div>

		<!-- Bonus -->
		<div class='col-span-2 text-center flex flex-col justify-center'>
			<span class='font-bold text-primary-900 text-lg leading-tight'
				>{casino.bonus_offer}</span
			>
			{
				(casino.bonus_spins || 0) > 0 && (
					<Badge variant="accent" size="sm" class="mt-1 inline-block mx-auto">
						+ {casino.bonus_spins} Free Spins
					</Badge>
				)
			}
		</div>

		<!-- CTA -->
		<div class='col-span-2 flex flex-col gap-2 justify-center text-center'>
			<Button
				href={casino.website_url}
				variant="primary"
				size="sm"
				class="text-sm uppercase tracking-wide"
			>
				Play Now
			</Button>
			<Button
				href={`/reviews/${review.slug}/`}
				variant="secondary"
				size="sm"
				class="text-sm uppercase tracking-wide"
			>
				Read Review
			</Button>
		</div>
	</div>
</div>
