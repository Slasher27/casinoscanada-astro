---
// src/components/ui/SlotsSection.astro
import { db } from '../../db/client';

// 1. Define the Interface (Same as your other pages)
interface SlotSql {
	slug: string;
	title: string;
	provider_name: string;
	image_url: string;
	rtp: number;
}

// 2. Query the DB for 'Featured' slots only
// We limit to 4 results so the homepage doesn't get cluttered
const slots = db
	.prepare(
		`
    SELECT 
        slots.slug, 
        slots.title, 
        slots.image_url, 
        slots.rtp, 
        software_providers.name as provider_name 
    FROM slots 
    JOIN software_providers ON slots.provider_id = software_providers.id
    WHERE slots.featured = 1
    LIMIT 4
`
	)
	.all() as SlotSql[];
---

<section class='py-16 bg-white border-t border-gray-100'>
	<div class='max-w-7xl mx-auto px-4 sm:px-6 lg:px-8'>
		<div
			class='flex flex-col sm:flex-row justify-between items-end mb-10 gap-4'
		>
			<div>
				<h2 class='text-3xl font-bold text-gray-900 tracking-tight'>
					Popular Free Slots
				</h2>
				<p class='mt-2 text-lg text-gray-600'>
					Play the latest demos before you bet real money.
				</p>
			</div>
			<a
				href='/slots'
				class='hidden sm:inline-flex group items-center text-blue-600 hover:text-blue-800 font-semibold transition-colors'
			>
				View All Games
				<svg
					class='w-5 h-5 ml-1 transform group-hover:translate-x-1 transition-transform'
					fill='none'
					stroke='currentColor'
					viewBox='0 0 24 24'
					><path
						stroke-linecap='round'
						stroke-linejoin='round'
						stroke-width='2'
						d='M17 8l4 4m0 0l-4 4m4-4H3'></path></svg
				>
			</a>
		</div>

		<div class='grid grid-cols-2 md:grid-cols-4 gap-6 lg:gap-8'>
			{
				slots.map((slot) => (
					<article class='group relative flex flex-col'>
						<div class='aspect-[4/3] bg-gray-100 rounded-xl overflow-hidden relative shadow-sm group-hover:shadow-md transition-all duration-300'>
							<img
								src={slot.image_url}
								alt={`Play ${slot.title} free demo`}
								class='w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-500'
								loading='lazy'
								onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
							/>

							<div class='hidden absolute inset-0 items-center justify-center bg-gray-200 text-gray-400 text-xs font-mono p-4 text-center'>
								Image Missing
							</div>

							<div class='absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center'>
								<span class='bg-white text-gray-900 px-5 py-2 rounded-full font-bold text-sm shadow-xl transform translate-y-2 group-hover:translate-y-0 transition-transform duration-300'>
									Play Demo
								</span>
							</div>
						</div>

						<div class='mt-4'>
							<h3 class='font-bold text-gray-900 text-lg leading-tight group-hover:text-blue-600 transition-colors'>
								<a href={`/slots/${slot.slug}`}>
									<span class='absolute inset-0' />
									{slot.title}
								</a>
							</h3>
							<div class='flex justify-between items-center mt-2'>
								<span class='text-sm text-gray-500 font-medium'>
									{slot.provider_name}
								</span>
								<span class='inline-flex items-center px-2 py-0.5 rounded text-xs font-bold bg-green-100 text-green-800'>
									RTP {slot.rtp}%
								</span>
							</div>
						</div>
					</article>
				))
			}
		</div>

		<div class='mt-8 text-center sm:hidden'>
			<a
				href='/slots'
				class='inline-block w-full px-6 py-3 border border-gray-300 rounded-lg text-base font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors'
			>
				View All Slots
			</a>
		</div>
	</div>
</section>
