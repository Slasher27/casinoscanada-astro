---
// src/components/ui/SlotsSection.astro
import { db } from '../../db/client';
import Heading from './Heading.astro';
import Button from './Button.astro';

// 1. Define the Interface (Same as your other pages)
interface SlotSql {
	slug: string;
	title: string;
	provider_name: string;
	image_url: string;
	rtp: number;
}

// 2. Query the DB for 'Featured' slots only
// We limit to 4 results so the homepage doesn't get cluttered
const slots = db
	.prepare(
		`
    SELECT
        slots.slug,
        slots.title,
        slots.image_url,
        slots.rtp,
        software_providers.name as provider_name
    FROM slots
    JOIN software_providers ON slots.provider_id = software_providers.id
    WHERE slots.featured = 1
    LIMIT 4
`
	)
	.all() as SlotSql[];
---

<section class='py-16 bg-white border-t border-primary-100'>
	<div class='max-w-7xl mx-auto px-4 sm:px-6 lg:px-8'>
		<div
			class='flex flex-col sm:flex-row justify-between items-end mb-10 gap-4'
		>
			<div>
				<Heading level={2} as="h2">
					Popular Free Slots
				</Heading>
				<p class='mt-2 text-lg text-primary-600'>
					Play the latest demos before you bet real money.
				</p>
			</div>
			<Button
				href='/slots/'
				variant="link"
				class='hidden sm:inline-flex group items-center'
			>
				View All Games
				<svg
					class='w-5 h-5 ml-1 transform group-hover:translate-x-1 transition-transform'
					fill='none'
					stroke='currentColor'
					viewBox='0 0 24 24'
					><path
						stroke-linecap='round'
						stroke-linejoin='round'
						stroke-width='2'
						d='M17 8l4 4m0 0l-4 4m4-4H3'></path></svg
				>
			</Button>
		</div>

		<div class='grid grid-cols-2 md:grid-cols-4 gap-6 lg:gap-8'>
			{
				slots.map((slot) => (
					<article class='group relative flex flex-col'>
						<div class='aspect-[4/3] bg-primary-100 rounded-card overflow-hidden relative shadow-card group-hover:shadow-card-hover transition-all duration-300'>
							<img
								src={slot.image_url}
								alt={`Play ${slot.title} free demo`}
								class='w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-500'
								loading='lazy'
								onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
							/>

							<div class='hidden absolute inset-0 items-center justify-center bg-primary-200 text-primary-600 text-xs font-mono p-4 text-center'>
								Image Missing
							</div>

							<div class='absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center pointer-events-none'>
								<a href={`/slots/${slot.slug}/`} class='pointer-events-auto bg-white hover:bg-accent-50 text-primary-900 hover:text-accent-700 rounded-btn-primary px-4 py-2 shadow-button transform scale-90 group-hover:scale-100 transition-transform flex items-center gap-2 font-bold text-xs uppercase tracking-wide'>
									<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-accent-600" viewBox="0 0 20 20" fill="currentColor">
										<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
									</svg>
									<span>Play Demo</span>
								</a>
							</div>
						</div>

						<div class='mt-4'>
							<h3 class='font-bold text-primary-900 text-lg leading-tight group-hover:text-accent-600 transition-colors'>
								<a href={`/slots/${slot.slug}/`}>
									{slot.title}
								</a>
							</h3>
							<div class='flex justify-between items-center mt-2'>
								<span class='text-sm text-primary-600 font-medium'>
									{slot.provider_name}
								</span>
								<span class='inline-flex items-center px-2 py-0.5 rounded-badge text-xs font-bold bg-success-50 text-success-700 border border-success-100'>
									RTP {slot.rtp}%
								</span>
							</div>
						</div>
					</article>
				))
			}
		</div>

		<div class='mt-8 text-center sm:hidden'>
			<Button
				href='/slots/'
				variant="secondary"
				size="md"
				class='w-full'
			>
				View All Slots
			</Button>
		</div>
	</div>
</section>
