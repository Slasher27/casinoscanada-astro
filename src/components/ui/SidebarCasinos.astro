---
// src/components/ui/SidebarCasinos.astro
import { db } from '../../db/client';

interface Props {
	excludeId?: string; // e.g. 'bitstarz' (so we don't show it twice)
}

interface SidebarCasino {
	id: string;
	name: string;
	logo_url: string | null;
	bonus_offer: string | null;
	payout_speed_minutes: number | null;
}

const { excludeId = '' } = Astro.props;

// Query: Get 5 casinos, excluding the current one
const topCasinos = db
	.prepare(
		`
  SELECT id, name, logo_url, bonus_offer, payout_speed_minutes
  FROM casinos
  WHERE id != ?
  LIMIT 5
`
	)
	.all(excludeId) as SidebarCasino[];
---

<div
	class='bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden'
>
	<div class='bg-slate-900 px-5 py-4 border-b border-gray-100'>
		<h3 class='font-bold text-white text-lg'>Top Recommended</h3>
	</div>

	<div class='divide-y divide-gray-100'>
		{
			topCasinos.map((casino) => (
				<div class='p-4 flex items-center gap-4 hover:bg-gray-50 transition-colors'>
					<div class='flex-shrink-0 w-12 h-12 bg-gray-100 rounded-full overflow-hidden border border-gray-200'>
						<img
							src={casino.logo_url}
							alt={casino.name}
							class='w-full h-full object-contain rounded-full'
							loading='lazy'
						/>
					</div>

					<div class='flex-1 min-w-0'>
						<h4 class='font-bold text-gray-900 text-sm truncate'>
							{casino.name}
						</h4>
						<p class='text-xs text-green-600 font-medium truncate'>
							{casino.bonus_offer}
						</p>
					</div>

					<a
						href={`/reviews/${casino.id}/`}
						class='flex-shrink-0 bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold px-3 py-2 rounded-md transition-colors'
					>
						Review
					</a>
				</div>
			))
		}
	</div>

	<div class='bg-gray-50 p-3 text-center border-t border-gray-100'>
		<a
			href='/#top-list'
			class='text-xs font-bold text-gray-500 hover:text-gray-800'
		>
			View All 50+ Casinos
		</a>
	</div>
</div>
