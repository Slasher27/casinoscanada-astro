---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

// 1. Generate paths for all guides
export async function getStaticPaths() {
	const guides = await getCollection('guides');
	return guides.map((entry) => ({
		params: { slug: entry.slug },
		props: { entry },
	}));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
---

<BaseLayout title={entry.data.title} description={entry.data.metaDescription}>
	<script
		type='application/ld+json'
		slot='head'
		set:html={JSON.stringify({
			'@context': 'https://schema.org',
			'@type': 'Article',
			headline: entry.data.title,
			datePublished: entry.data.pubDate,
			dateModified: entry.data.updatedDate || entry.data.pubDate,
			author: {
				'@type': 'Person',
				name: entry.data.author,
			},
		})}
	/>

	<div class='max-w-4xl mx-auto'>
		<nav class='text-sm text-gray-500 mb-6'>
			<a href='/' class='hover:text-blue-600'>Home</a> &rsaquo;
			<span class='text-gray-900 font-bold'>Guides</span>
		</nav>

		<header class='mb-10 text-center'>
			<h1 class='text-4xl md:text-5xl font-black text-slate-900 mb-4'>
				{entry.data.title}
			</h1>
			<div class='flex justify-center items-center gap-4 text-gray-600 text-sm'>
				<span>âœï¸ {entry.data.author}</span>
				<span
					>ğŸ“… Last Updated: {
						entry.data.pubDate.toLocaleDateString('en-CA')
					}</span
				>
			</div>
		</header>

		<article
			class='prose prose-lg prose-blue max-w-none bg-white p-8 md:p-12 rounded-2xl shadow-sm border border-gray-100'
		>
			<Content />
		</article>
	</div>
</BaseLayout>
