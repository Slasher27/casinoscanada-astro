---
import { getCollection } from 'astro:content';
import ReviewLayout from '../../layouts/ReviewLayout.astro';

// 1. getStaticPaths (No change needed)
export async function getStaticPaths() {
	const reviews = await getCollection('reviews');
	return reviews.map((entry) => ({
		params: { slug: entry.slug },
		props: { entry },
	}));
}

const { entry } = Astro.props;
// Extract 'headings' for TOC
const { Content, headings } = await entry.render();
---

<ReviewLayout frontmatter={entry.data} headings={headings}>
	<script
		type='application/ld+json'
		slot='head'
		set:html={JSON.stringify({
			'@context': 'https://schema.org/',
			'@type': 'Review',
			itemReviewed: {
				'@type': 'Casino',
				name: entry.data.title,
				description: entry.data.metaDescription,
			},
			reviewRating: {
				'@type': 'Rating',
				ratingValue: entry.data.rating,
				bestRating: 5,
				worstRating: 1,
			},
			author: {
				'@type': 'Organization',
				name: entry.data.author,
				url: 'https://casinoscanada.online',
			},
			publisher: {
				'@type': 'Organization',
				name: 'CasinosCanada',
				logo: {
					'@type': 'ImageObject',
					url: 'https://casinoscanada.online/logo.png',
				},
			},
			datePublished: entry.data.pubDate,
			// New: Pros & Cons in Schema
			positiveNotes: entry.data.pros
				? {
						'@type': 'ItemList',
						itemListElement: entry.data.pros.map((pro, i) => ({
							'@type': 'ListItem',
							position: i + 1,
							name: pro,
						})),
					}
				: undefined,
			negativeNotes: entry.data.cons
				? {
						'@type': 'ItemList',
						itemListElement: entry.data.cons.map((con, i) => ({
							'@type': 'ListItem',
							position: i + 1,
							name: con,
						})),
					}
				: undefined,
		})}
	/>

	<div class='prose prose-lg prose-slate max-w-none'>
		<Content />
	</div>
</ReviewLayout>
