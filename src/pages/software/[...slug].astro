---
// src/pages/software/[...slug].astro
import BaseLayout from '../../layouts/BaseLayout.astro';
import { db } from '../../db/client';
import Breadcrumbs from '../../components/ui/Breadcrumbs.astro';

export async function getStaticPaths() {
	const providers = db.prepare('SELECT * FROM software_providers').all();
	return providers.map((provider: any) => ({
		params: { slug: provider.id },
		props: { provider },
	}));
}

const { provider } = Astro.props;

// Get slots for this provider
const slots = db
	.prepare(`SELECT * FROM slots WHERE provider_id = ?`)
	.all(provider.id) as any[];
---

<BaseLayout
	title={`${provider.name} Slots | Best ${provider.name} Casinos in Canada`}
	description={`Play the best free slots by ${provider.name}. List of top RTP games and casinos offering ${provider.name} titles.`}
>
	<div class='container mx-auto px-4 pt-8'>
		<Breadcrumbs
			items={[
				{ text: 'Software', href: '/software' },
				{ text: provider.name, href: Astro.url.pathname },
			]}
		/>
	</div>
	<div class='bg-white border-b border-gray-200 py-12 mb-12'>
		<div
			class='container mx-auto px-4 flex flex-col md:flex-row items-center gap-8'
		>
			<div
				class='w-32 h-32 bg-white rounded-xl shadow-sm border border-gray-100 p-4 flex items-center justify-center flex-shrink-0'
			>
				<img
					src={`/images/software/${provider.id}.png`}
					alt={provider.name}
					class='max-w-full max-h-full object-contain rounded-lg'
					onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
				/>

				<div class='hidden text-4xl font-bold text-gray-300'>
					{provider.name.charAt(0)}
				</div>
			</div>

			<div class='text-center md:text-left'>
				<h1 class='text-4xl font-bold text-gray-900 mb-2'>
					{provider.name} Slots
				</h1>
				<p class='text-xl text-gray-600'>
					We found <strong>{slots.length}</strong> free demos available in our database.
				</p>
			</div>
		</div>
	</div>

	<div class='container mx-auto px-4 pb-16'>
		{
			slots.length === 0 ? (
				<div class='text-center py-20 bg-gray-50 rounded-xl border border-dashed border-gray-300'>
					<p class='text-gray-500'>No slots found for {provider.name} yet.</p>
				</div>
			) : (
				<div class='grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6'>
					{slots.map((slot) => (
						<article class='group bg-white rounded-xl shadow-sm hover:shadow-lg transition-all duration-300 border border-gray-100 overflow-hidden flex flex-col'>
							<a
								href={`/slots/${slot.slug}`}
								class='relative aspect-[4/3] bg-gray-200 block overflow-hidden'
							>
								<img
									src={slot.image_url}
									alt={`${slot.title} demo`}
									class='w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500'
									loading='lazy'
									onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
								/>
								<div class='hidden absolute inset-0 items-center justify-center bg-gray-100 text-gray-400 text-xs font-mono'>
									No Image
								</div>
							</a>
							<div class='p-4'>
								<h3 class='font-bold text-gray-900 text-lg leading-tight group-hover:text-blue-600'>
									<a href={`/slots/${slot.slug}`}>{slot.title}</a>
								</h3>
								<div class='mt-2 text-sm text-gray-500'>
									RTP: <span class='text-green-600 font-bold'>{slot.rtp}%</span>
								</div>
							</div>
						</article>
					))}
				</div>
			)
		}
	</div>
</BaseLayout>
